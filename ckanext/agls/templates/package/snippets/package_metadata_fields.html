{% ckan_extends %}

{# Remove 'free extras' from the package form. If you're using
convert_to/from_extras() as we are with our 'custom_text' field below then
you need to remove free extras from the form, or editing your custom field
won't work. #}
{% block custom_fields %}
{% endblock %}

{% block package_metadata_fields %}
    {#     {% set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': '', 'data-module-source': '/api/2/util/tag/autocomplete?incomplete=?'} %}
            {{ form.input('field_of_research', id='field-field_of_research', label=_('Field of Research'), placeholder=_('eg. economy, mental health, government'), value=field_of_research, error=errors.field_of_research, classes=['control-full'], attrs=tag_attrs) }}
            {% set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': '', 'data-module-source': '/api/2/util/tag/autocomplete?incomplete=?'} %}
            {{ form.input('geospatial_topic', id='field-geospatial_topic', label=_('Geospatial Topic'), placeholder=_('eg. economy, mental health, government'), value=geospatial_topic, error=errors.geospatial_topic, classes=['control-full'], attrs=tag_attrs) }}
 #}
    <div class="control-group control-medium">
        <label class="control-label" for="field-field_of_research">{{ _("Field of Research") }}</label>

        <div class="controls">
            <select id="field-field_of_research" name="field_of_research" multiple data-module="autocomplete">
                {% for field_of_research in h.fields_of_research %}
                    <option value="{{ field_of_research }}"
                            {% if field_of_research in data.get('fields_of_research', []) %}selected="selected"{% endif %}>{{ field_of_research }}</option>
                {% endfor %}
            </select>
        <br/>
            The Australian and New Zealand Standard Research Classification (ANZSRC), 2008 defined <a href="http://www.abs.gov.au/AUSSTATS/abs@.nsf/0/6BB427AB9696C225CA2574180004463E?opendocument">field or fields of research</a> relevant to the dataset.
        </div>

    </div>

    <div class="control-group control-medium">
        <label class="control-label" for="field-geospatial_topic">{{ _("Geospatial Topic") }}</label>

        <div class="controls">
    <!--[if lt IE 9]>
            <select id="field-geospatial_topic" name="geospatial_topic" multiple>
            <![endif]-->
            <!--[if gte IE 8]> -->
            <select id="field-geospatial_topic" name="geospatial_topic" multiple data-module="autocomplete">
            <!-- <![endif]-->
                {% for geospatial_topic in h.geospatial_topics %}
                    <option value="{{ geospatial_topic }}"
                            {% if geospatial_topic in data.get('geospatial_topic', []) %}selected="selected"{% endif %}>{{ geospatial_topic }}</option>
                {% endfor %}
            </select>
        </div>
        The high level <a href="https://www2.landgate.wa.gov.au/interragatorplus/help/index.html?iso_19115_topic_categories.htm">ISO19115</a> topics. Optional but recommended.
    </div>


    {%  call form.markdown('data_models', label=_('Data Models'), id='field-data-models',
placeholder=_('Information on any relevant data models, ontologies, taxonomies etc specific to this dataset.'),
value=data.update_freq, error=errors.update_freq, classes=['control-full']) %}


    Please add any links to information on relevant data models, ontologies, taxonomies etc specific to your dataset. You can upload data models to the <link>data.gov.au data model repository</link>.
{% endcall %}
    {{ super() }}

{% endblock %}

{# https://github.com/okfn/ckan/blob/master/ckan/templates/macros/form.html documents the macros for fields #}

{# hide author/maintainer fields
TODO Autofill with author name #}
{% block package_metadata_author %}

    {{ form.hidden('author', 'value') }}
{% endblock %}

{% block package_metadata_fields_maintainer %}
{% endblock %}
{% block package_metadata_fields_url %}
{% endblock %}

{% block package_metadata_fields_version %}
{% endblock %}

{% block dataset_fields %}
    {% if data.groups %}
        <div class="control-group">
            <label class="control-label">Groups/Themes</label>

            <div class="controls">
                {% for group in data.groups %}
                    <label class="checkbox" for="field-group-{{ loop.index0 }}">
                        <input id="field-group-{{ loop.index0 }}" type="checkbox" name="groups__{{ loop.index0 }}__id"
                               value="{{ group.id }}" checked="checked"/>
                        {{ group.title }}
                    </label>
                {% endfor %}
            </div>
        </div>
    {% endif %}
    {% set group_name = 'groups__%s__id' % data.groups|length %}
    {% set group_attrs = {'data-module': 'autocomplete', 'data-module-source': '/api/2/util/group/autocomplete?q=?', 'data-module-key': 'id', 'data-module-label': 'title'} %}
    {{ form.input(group_name, label=_('Add Group/Theme'), id="field-group", value=data[group_name], classes=['control-medium'], attrs=group_attrs) }}
    {# form.select(group_name, label=_('Add Group/Theme'), id="field-group", selected=data[group_name], classes=['control-medium'], options=h.get_group_select_list) #}
{% endblock %}